{"id":"fp-1","title":"Fix prefix mismatch error in bd sync with --rename-on-import flag","description":"The GitHub Action fails during bd sync with 'prefix mismatch detected' error because some issues in the JSONL have 'family-' prefix while the database expects 'family-panel-' prefix.","design":"Error from workflow:\n```\nError importing: import failed: exit status 1\nImport failed: prefix mismatch detected: database uses 'family-panel-' \nbut found issues with prefixes: [family- (3 issues)] \n(use --rename-on-import to automatically fix)\n```\n\nRoot cause: During the sync operation, bd tries to pull from remote and import the JSONL, but discovers a prefix mismatch. Some issues have 'family-' prefix while the database was initialized with 'family-panel-' prefix.\n\nSolution: Add --rename-on-import flag to bd sync command to automatically fix prefix mismatches during import:\n\n```yaml\nbd sync --rename-on-import\n```\n\nThis flag tells bd to automatically rename issues to match the database's configured prefix during the import phase of the sync operation.","acceptance_criteria":"- bd sync runs with --rename-on-import flag\n- Prefix mismatches are automatically fixed during import\n- No import errors\n- Workflow completes successfully\n- Issues.jsonl is properly committed and pushed","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-11-27T19:38:47.107237-05:00","updated_at":"2025-11-27T21:12:46.62539-05:00","closed_at":"2025-11-27T21:12:46.62539-05:00"}
{"id":"fp-10","title":"Fix syntax error in GitHub Actions workflow commit message","description":"The close-beads-issue.yml workflow has a shell syntax error on line 65 where the commit message has an unescaped newline in a double-quoted string.","design":"Fix the git commit command to use two -m flags instead of a multi-line string:\n- First -m: \"chore: close ... merge\"\n- Second -m: \"ðŸ¤– Automated beads issue closure via GitHub Actions\"\n\nThis is the proper git way to create multi-paragraph commit messages.","acceptance_criteria":"- Workflow file passes YAML syntax validation\n- Git commit command is properly formatted\n- Workflow can execute without syntax errors","notes":"Waiting for PR #3 review. Work complete: Fixed shell syntax error in GitHub Actions workflow by changing git commit command from single -m with multi-line string to two -m flags for proper multi-paragraph commit message.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-11-27T14:41:48.106751-05:00","updated_at":"2025-11-27T21:12:48.04479-05:00","closed_at":"2025-11-27T21:12:48.04479-05:00"}
{"id":"fp-11","title":"Build chore management service and API endpoints","description":"Create ChoreService with business logic for creating, reading, updating, and deleting chores. Implement API routes with proper authorization.","design":"ChoreService methods:\n- createChore(name, description, monetaryValue) - parents only\n- getChores() - all users\n- updateChore(id, updates) - parents only\n- deleteChore(id) - parents only\n\nAPI routes:\n- POST /api/chores - create\n- GET /api/chores - list all\n- PATCH /api/chores/[id] - update\n- DELETE /api/chores/[id] - delete\n\nValidate user role before allowing write operations.","acceptance_criteria":"- All CRUD operations work via API\n- Parents can create/edit/delete chores\n- Kids can view chores but not modify\n- Monetary values stored as cents (integers)\n- API returns proper error codes for unauthorized access","status":"open","priority":1,"issue_type":"feature","created_at":"2025-11-27T10:41:35.983636-05:00","updated_at":"2025-11-27T20:11:42.266524-05:00","dependencies":[{"issue_id":"fp-11","depends_on_id":"fp-8","type":"blocks","created_at":"2025-11-27T10:41:35.985234-05:00","created_by":"daemon"}]}
{"id":"fp-12","title":"Implement chore assignment and completion system","description":"Create functionality for parents to assign chores to kids on specific dates, and for kids to mark chores as complete.","design":"ChoreAssignmentService methods:\n- assignChore(choreId, kidId, date) - parents only\n- getAssignmentsForDate(date, kidId?) - all users\n- completeChore(assignmentId) - assigned kid or parents\n- uncompleteChore(assignmentId) - parents only\n\nAPI routes:\n- POST /api/chore-assignments - assign\n- GET /api/chore-assignments?date=YYYY-MM-DD\u0026kidId=X - list\n- PATCH /api/chore-assignments/[id]/complete - mark complete\n- PATCH /api/chore-assignments/[id]/uncomplete - unmark\n\nStore completion timestamp for payment tracking.","acceptance_criteria":"- Parents can assign any chore to any kid on any date\n- Kids can view their assigned chores\n- Kids can mark their own chores complete\n- Completion timestamp is recorded\n- Can query assignments by date and/or kid\n- Real-time updates via Supabase subscriptions","status":"open","priority":1,"issue_type":"feature","created_at":"2025-11-27T10:41:44.144993-05:00","updated_at":"2025-11-27T20:11:42.267086-05:00","dependencies":[{"issue_id":"fp-12","depends_on_id":"fp-11","type":"blocks","created_at":"2025-11-27T10:41:44.145695-05:00","created_by":"daemon"}]}
{"id":"fp-13","title":"Build parent admin UI for chore management","description":"Create parent-facing UI for creating/editing chores and assigning them to kids on specific dates.","design":"Parent dashboard pages:\n- /admin/chores - List all chores with create/edit/delete actions\n- /admin/chores/new - Form to create new chore\n- /admin/chores/[id]/edit - Edit existing chore\n- /admin/assignments - Calendar/weekly view to assign chores\n  - Select kid, date, and chore from dropdowns\n  - See what's already assigned\n\nUse shadcn/ui components for forms, tables, and buttons.","acceptance_criteria":"- Parents can create new chores with name, description, and $ value\n- Parents can edit and delete existing chores\n- Parents can assign chores to kids for specific dates\n- UI is responsive and works on mobile/tablet\n- Form validation provides helpful feedback","status":"open","priority":1,"issue_type":"feature","created_at":"2025-11-27T10:41:52.550774-05:00","updated_at":"2025-11-27T20:11:42.267626-05:00","dependencies":[{"issue_id":"fp-13","depends_on_id":"fp-12","type":"blocks","created_at":"2025-11-27T10:41:52.552041-05:00","created_by":"daemon"}]}
{"id":"fp-14","title":"Build kid dashboard with daily chore view","description":"Create kid-facing dashboard showing today's assigned chores with ability to mark them complete.","design":"Kid dashboard at /dashboard:\n- Shows kid's name and current date\n- List of today's assigned chores\n- Each chore shows: name, description, $ value, completion status\n- Large, touch-friendly \"Mark Complete\" button\n- Visual feedback when marked complete (checkmark, animation)\n- Auto-refresh via Supabase real-time subscriptions\n- Simple, colorful UI appropriate for kids\n\nResponsive design works on tablets and phones.","acceptance_criteria":"- Kids see their assigned chores for today\n- Kids can mark chores complete with one tap\n- Completed chores show visual confirmation\n- Updates appear in real-time across devices\n- UI is kid-friendly and intuitive\n- Works well on touch devices","status":"open","priority":1,"issue_type":"feature","created_at":"2025-11-27T10:41:59.936551-05:00","updated_at":"2025-11-27T20:11:42.268159-05:00","dependencies":[{"issue_id":"fp-14","depends_on_id":"fp-12","type":"blocks","created_at":"2025-11-27T10:41:59.937565-05:00","created_by":"daemon"}]}
{"id":"fp-15","title":"Implement recurring chore assignment system","description":"Allow parents to create recurring chore assignments (daily, weekly, custom schedule) that auto-generate assignments.","design":"New table: chore_recurrence_rules\n- chore_id, kid_id, frequency (daily/weekly/custom), days_of_week, start_date, end_date\n\nChoreRecurrenceService:\n- createRule(choreId, kidId, frequency, days) - parents only\n- generateAssignments(date) - background job\n- updateRule(id, updates) - parents only\n- deleteRule(id) - parents only\n\nBackground job runs daily at midnight to generate next day's assignments based on active rules.\n\nParents can still create ad-hoc assignments that override or supplement recurring ones.","acceptance_criteria":"- Parents can create weekly recurring patterns (e.g., \"Kid A does dishes Mon/Wed/Fri\")\n- Assignments auto-generate daily based on rules\n- Parents can edit/delete recurring rules\n- Ad-hoc assignments still work\n- UI shows which assignments are from recurring rules\n- Can temporarily skip a recurring assignment","status":"open","priority":2,"issue_type":"feature","created_at":"2025-11-27T10:42:09.581481-05:00","updated_at":"2025-11-27T20:11:42.268673-05:00","dependencies":[{"issue_id":"fp-15","depends_on_id":"fp-13","type":"blocks","created_at":"2025-11-27T10:42:09.582623-05:00","created_by":"daemon"}]}
{"id":"fp-16","title":"Build payment calculation and reporting system","description":"Create service and UI for calculating total earnings from completed chores over a specified date range.","design":"PaymentService methods:\n- calculateEarnings(kidId, startDate, endDate) - sums completed chore values\n- getEarningsBreakdown(kidId, startDate, endDate) - detailed list\n- markAsPaid(kidId, startDate, endDate, amount) - records payment\n\nParent UI at /admin/payments:\n- Select kid and date range (last 7/14/30 days or custom)\n- Shows completed chores with $ values\n- Total earnings displayed prominently\n- \"Mark as Paid\" button to record payment\n- Payment history log\n\nKid UI shows their current unpaid earnings.","acceptance_criteria":"- Correctly calculates total $ owed for completed chores\n- Parents can view earnings by kid and date range\n- Parents can mark periods as paid\n- Kids can see their current unpaid balance\n- Breakdown shows which chores contributed to total","status":"open","priority":2,"issue_type":"feature","created_at":"2025-11-27T10:42:24.219031-05:00","updated_at":"2025-11-27T20:11:42.269197-05:00","dependencies":[{"issue_id":"fp-16","depends_on_id":"fp-14","type":"blocks","created_at":"2025-11-27T10:42:24.220264-05:00","created_by":"daemon"}]}
{"id":"fp-17","title":"Implement incentive types and configuration system","description":"Allow parents to create and configure incentive types (reading, exercise, etc.) with customizable rewards per kid.","design":"Tables:\n- incentive_types: global incentive definitions (name, unit_name, default_reward_cents, default_reward_minutes)\n- kid_incentive_config: per-kid overrides (kid_id, incentive_type_id, reward_cents_per_unit, reward_minutes_per_unit, target_units_per_day)\n\nIncentiveService:\n- createIncentiveType(name, unit) - parents only\n- configureForKid(kidId, incentiveTypeId, rewards, target) - parents only\n- getKidIncentives(kidId) - returns active incentives with their rewards\n\nExamples:\n- Reading: 10 pages = $1 or 10 minutes screen time\n- Exercise: 15 minutes = $0.50 or 5 minutes screen time\n- Practice instrument: 30 minutes = $2 or 15 minutes screen time\n\nEach kid can have different reward rates and targets.","acceptance_criteria":"- Parents can create incentive types\n- Parents can configure rewards per kid per incentive\n- Different kids can have different reward rates\n- Can specify rewards in $ or screen time minutes (or both)\n- Targets are optional goals, not limits","status":"open","priority":2,"issue_type":"feature","created_at":"2025-11-27T10:42:33.847137-05:00","updated_at":"2025-11-27T20:11:42.269709-05:00","dependencies":[{"issue_id":"fp-17","depends_on_id":"fp-14","type":"blocks","created_at":"2025-11-27T10:42:33.84782-05:00","created_by":"daemon"}]}
{"id":"fp-18","title":"Build incentive logging and reward selection UI","description":"Create UI for kids to log their incentive activities and choose between cash or screen time rewards.","design":"Kid dashboard additions:\n- Section showing active incentives with targets\n- Simple input to log units completed (e.g., \"Read 20 pages today\")\n- Calculate reward based on units * rate\n- Present choice: \"Take $2.00 cash\" or \"Add 20 minutes screen time\"\n- Log selection in incentive_logs table with reward_type field\n\nIncentiveLoggingService:\n- logIncentive(kidId, incentiveTypeId, units, rewardType) - kid or parent\n- getIncentiveLogsForDate(kidId, date)\n- getTodaysProgress(kidId) - shows how close to targets\n\nRewards integrate with payment system (cash) or screen time system (minutes).","acceptance_criteria":"- Kids can log incentive activities daily\n- UI shows calculated reward before kid chooses\n- Kids choose cash or screen time per entry\n- Chosen rewards apply to appropriate system\n- Parents can view and edit kid's incentive logs\n- Today's progress shows on kid dashboard","status":"open","priority":2,"issue_type":"feature","created_at":"2025-11-27T10:42:44.360709-05:00","updated_at":"2025-11-27T20:11:42.270226-05:00","dependencies":[{"issue_id":"fp-18","depends_on_id":"fp-17","type":"blocks","created_at":"2025-11-27T10:42:44.362059-05:00","created_by":"daemon"}]}
{"id":"fp-19","title":"Implement screen time tracking service and timer logic","description":"Build backend service for tracking screen time sessions with daily limits, bonus minutes, and start/stop functionality.","design":"ScreenTimeService:\n- startSession(kidId) - creates new session, checks available time\n- stopSession(sessionId) - ends session, calculates duration\n- getRemainingTime(kidId) - calculates: daily_limit + bonus_minutes - today's used time\n- addBonusMinutes(kidId, minutes) - called from incentive system\n- getCurrentSession(kidId) - returns active session if any\n- getTodaysSessions(kidId) - history\n\nLogic:\n- Each kid has screen_time_daily_minutes (configurable per kid)\n- Bonus minutes from incentives add to daily allowance\n- Timer counts down from remaining time\n- Daily reset at midnight\n- Can't start if no time remaining (or allow parent override)","acceptance_criteria":"- Can start/stop screen time sessions\n- Correctly calculates remaining time including bonuses\n- Sessions are recorded with timestamps\n- Daily limit is enforced (or parent can override)\n- Time resets at midnight\n- Handles edge cases (session crosses midnight, etc.)","status":"open","priority":2,"issue_type":"feature","created_at":"2025-11-27T10:43:06.270909-05:00","updated_at":"2025-11-27T20:11:42.270716-05:00","dependencies":[{"issue_id":"fp-19","depends_on_id":"fp-8","type":"blocks","created_at":"2025-11-27T10:43:06.272338-05:00","created_by":"daemon"}]}
{"id":"fp-2","title":"Configure git identity before bd sync in GitHub Action","description":"The GitHub Action fails during bd sync with 'Author identity unknown' error because bd sync attempts to commit changes but git user.name/user.email aren't configured yet at that point in the workflow.","design":"Error from workflow:\n```\nError committing: git commit failed: exit status 128\nAuthor identity unknown\nfatal: empty ident name not allowed\n```\n\nRoot cause: bd sync tries to commit changes to git (as seen in the output \"Committing changes to git...\"), but git config user.name/user.email are set in a later step.\n\nSolution: Move the git config commands to run BEFORE the bd sync command, either:\n1. Add a separate step after \"Initialize beads database\" to configure git\n2. Or set git config within the \"Close beads issue\" step before running bd sync\n\nRecommended approach: Add git config setup right after initializing beads database so it's available for all bd commands that might need it.","acceptance_criteria":"- Git user.name and user.email are configured before bd sync runs\n- bd sync can successfully commit changes\n- No git identity errors\n- Workflow completes successfully\n- Issues.jsonl is properly committed and pushed","notes":"Waiting for PR #7 review. Work complete: Added 'Configure git identity' step after initializing beads database to set git user.name and user.email before bd sync runs. Removed duplicate git config from later step. This fixes the 'Author identity unknown' error when bd sync tries to commit changes.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-11-27T19:33:00.841923-05:00","updated_at":"2025-11-27T21:12:48.951064-05:00","closed_at":"2025-11-27T21:12:48.951064-05:00"}
{"id":"fp-20","title":"Build screen time timer UI for kids","description":"Create kid-facing screen time countdown timer with large, easy-to-read display and start/stop controls.","design":"Kid dashboard additions:\n- Prominent timer display showing remaining time (HH:MM:SS or MM:SS)\n- Large \"Start Screen Time\" button when no active session\n- Large \"Stop Screen Time\" button during active session\n- Visual countdown animation\n- Show bonus minutes separately (\"120 daily + 20 bonus = 140 total\")\n- Warning when time is running low (\u003c 15 minutes)\n- Notification when time runs out\n\nReal-time countdown using client-side timer synced with server.\nUpdates every second during active session.\nPersist timer state in case of page refresh.","acceptance_criteria":"- Timer displays remaining time clearly\n- Kids can start/stop timer with one tap\n- Countdown updates in real-time\n- Shows daily limit + bonus minutes\n- Visual/audio alert when time runs out\n- Timer state persists across page refreshes\n- Works on touch devices","status":"open","priority":2,"issue_type":"feature","created_at":"2025-11-27T10:43:15.38906-05:00","updated_at":"2025-11-27T20:11:42.271209-05:00","dependencies":[{"issue_id":"fp-20","depends_on_id":"fp-19","type":"blocks","created_at":"2025-11-27T10:43:15.389845-05:00","created_by":"daemon"}]}
{"id":"fp-21","title":"Add bd sync command after closing issue in GitHub Action","description":"The GitHub Action reports no changes to commit after running bd close because changes aren't immediately flushed to issues.jsonl. Need to add 'bd sync' command to immediately export changes before committing.","design":"According to beads documentation:\n- bd automatically exports to issues.jsonl after 5 seconds (debounce)\n- 'bd sync' command immediately flushes pending changes to JSONL\n- Git hooks provide zero-lag sync but aren't available in GitHub Actions\n\nSolution: Add 'bd sync' command after 'bd close' in the workflow to immediately flush the database changes to issues.jsonl before attempting to commit.\n\nWorkflow change:\n```yaml\n- name: Close beads issue\n  run: |\n    bd close ${{ issue_id }} --reason \"...\" --json\n    bd sync  # Immediately flush to issues.jsonl\n```","acceptance_criteria":"- bd sync command runs after bd close\n- Changes are immediately flushed to issues.jsonl\n- Git detects changes to commit\n- Updated issues.jsonl is committed and pushed\n- Workflow completes successfully","notes":"Waiting for PR #6 review. Work complete: Added 'bd sync' command after 'bd close' in GitHub Action workflow to immediately flush database changes to issues.jsonl, bypassing the 5-second debounce timer. This ensures git can detect and commit the updated issues.jsonl file.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-11-27T19:27:50.929866-05:00","updated_at":"2025-11-27T21:12:51.412821-05:00","closed_at":"2025-11-27T21:12:51.412821-05:00"}
{"id":"fp-22","title":"Build parent screen time management UI","description":"Create parent interface for configuring daily limits, viewing usage history, and managing screen time for each kid.","design":"Parent UI at /admin/screen-time:\n- Configure daily minutes limit per kid\n- View current status for all kids (remaining time, active sessions)\n- View usage history (daily totals, session logs)\n- Emergency controls:\n  - Add bonus minutes manually\n  - Pause/extend active session\n  - Reset for the day (parent override)\n- Analytics: average daily usage, trends over time\n\nReal-time updates show when kids start/stop sessions.","acceptance_criteria":"- Parents can set daily limit per kid\n- Parents can view real-time status for all kids\n- Parents can add bonus minutes manually\n- Parents can view usage history and analytics\n- Parents can override limits when needed\n- UI updates in real-time when kids use timers","status":"open","priority":2,"issue_type":"feature","created_at":"2025-11-27T10:43:23.650005-05:00","updated_at":"2025-11-27T20:11:42.272118-05:00","dependencies":[{"issue_id":"fp-22","depends_on_id":"fp-20","type":"blocks","created_at":"2025-11-27T10:43:23.651446-05:00","created_by":"daemon"}]}
{"id":"fp-23","title":"Build app-native calendar with CRUD operations","description":"Create calendar system within the app for family events that can be created, edited, and deleted by parents.","design":"Table: calendar_events\n- id, title, description, start_time, end_time, location, source_type (native/subscribed/work), source_id, visibility (all/parents-only/private), color, created_by\n\nCalendarService:\n- createEvent(eventData) - parents only\n- updateEvent(id, updates) - parents only\n- deleteEvent(id) - parents only\n- getEvents(startDate, endDate, userId) - respects visibility\n- getEventsForDate(date, userId)\n\nVisibility rules:\n- \"all\" = everyone sees it\n- \"parents-only\" = only parents see it\n- Private events show as \"Busy\" to non-owners\n\nAPI routes for full CRUD operations.","acceptance_criteria":"- Parents can create calendar events\n- Parents can edit and delete events they created\n- Events have title, time, location, description\n- Visibility controls work correctly\n- Kids see appropriate events based on visibility\n- Events can be all-day or time-specific","status":"open","priority":2,"issue_type":"feature","created_at":"2025-11-27T10:43:38.89664-05:00","updated_at":"2025-11-27T20:11:42.272617-05:00","dependencies":[{"issue_id":"fp-23","depends_on_id":"fp-8","type":"blocks","created_at":"2025-11-27T10:43:38.89786-05:00","created_by":"daemon"}]}
{"id":"fp-24","title":"Build calendar view UI for all users","description":"Create calendar interface showing events in month/week/day views, accessible to both parents and kids with appropriate controls.","design":"Calendar UI at /calendar:\n- Month view (primary), week view, day/agenda view\n- Display all events user has permission to see\n- Color-coded by source/type\n- Click event to see details\n- Parents: \"Add Event\" button â†’ modal/form\n- Parents: Click event â†’ edit/delete options\n- Kids: Read-only view with event details\n- Show chores alongside calendar events (integrated view)\n\nUse a calendar library (e.g., react-big-calendar or FullCalendar) for the UI.\nMobile-responsive views.","acceptance_criteria":"- Calendar displays events in month/week/day views\n- Parents can add events via UI\n- Parents can edit/delete events by clicking\n- Kids see calendar in read-only mode\n- Events respect visibility rules\n- UI is responsive on mobile/tablet\n- Performance is good with 100+ events","status":"open","priority":2,"issue_type":"feature","created_at":"2025-11-27T10:43:47.933098-05:00","updated_at":"2025-11-27T20:11:42.273463-05:00","dependencies":[{"issue_id":"fp-24","depends_on_id":"fp-23","type":"blocks","created_at":"2025-11-27T10:43:47.933862-05:00","created_by":"daemon"}]}
{"id":"fp-25","title":"Implement external calendar subscription (iCal/CalDAV)","description":"Allow parents to subscribe to external calendars via iCal URLs (school, sports, shared family calendars) and sync events automatically.","design":"Table: calendar_subscriptions\n- id, name, ical_url, color, enabled, last_sync, sync_frequency_minutes\n\nCalendarSyncService:\n- addSubscription(name, url, color) - parents only\n- syncSubscription(subscriptionId) - fetches and parses iCal\n- updateSubscription(id, updates)\n- deleteSubscription(id)\n- syncAllSubscriptions() - background job\n\nUse ical.js library to parse iCal feeds.\nBackground job runs every 30 minutes to sync all enabled subscriptions.\nStore synced events in calendar_events with source_type='subscribed'.\n\nHandle updates: compare existing events, update changed ones, delete removed ones.","acceptance_criteria":"- Parents can add iCal subscription URLs\n- Calendar automatically syncs every 30 minutes\n- Synced events appear in calendar view\n- Events are color-coded by subscription\n- Parents can manually trigger sync\n- Parents can enable/disable subscriptions\n- Handle parse errors gracefully","status":"open","priority":3,"issue_type":"feature","created_at":"2025-11-27T10:43:57.796636-05:00","updated_at":"2025-11-27T20:11:42.274072-05:00","dependencies":[{"issue_id":"fp-25","depends_on_id":"fp-24","type":"blocks","created_at":"2025-11-27T10:43:57.798059-05:00","created_by":"daemon"}]}
{"id":"fp-26","title":"Design and implement work calendar sync agent (Go)","description":"Create standalone desktop application in Go that runs on work machines and syncs Outlook/Google Calendar events to Family Panel API.","design":"Go desktop agent features:\n- Authenticates to Family Panel API with parent credentials\n- Reads local Outlook (Windows) or Calendar.app (Mac) data\n- Configurable filters:\n  - Event title patterns (include/exclude)\n  - Calendar categories\n  - Busy/free only vs. full details\n  - Title anonymization (\"Meeting\" instead of actual title)\n- Runs in system tray, minimal UI\n- Syncs every 15-30 minutes\n- Encrypted local config file\n- Push events to POST /api/calendar/work-sync endpoint\n\nPlatform-specific implementations:\n- Windows: Use Outlook COM API or EWS\n- Mac: Use Calendar.app's SQLite database or EventKit framework\n\nDistribute as single binary per platform.","acceptance_criteria":"- Agent runs on Windows and Mac\n- Authenticates to Family Panel API securely\n- Reads calendar events locally (no cloud access)\n- Filters work correctly\n- Parents can configure sync settings\n- Events appear in Family Panel calendar\n- Runs silently in background\n- Easy installation/setup","status":"open","priority":3,"issue_type":"feature","created_at":"2025-11-27T10:44:09.507724-05:00","updated_at":"2025-11-27T20:11:42.274668-05:00","dependencies":[{"issue_id":"fp-26","depends_on_id":"fp-23","type":"blocks","created_at":"2025-11-27T10:44:09.508822-05:00","created_by":"daemon"}]}
{"id":"fp-27","title":"Build TV display mode with auto-rotating views","description":"Create display-only interface optimized for wall-mounted TVs that auto-rotates through different information views.","design":"Display mode at /display:\n- Full-screen, read-only interface\n- Auto-rotates every 15 seconds through views:\n  1. Today's date, time, weather\n  2. Today's chores by kid (with completion status)\n  3. Calendar: Today + next 3-7 days\n  4. Screen time remaining per kid\n  5. Upcoming birthdays/special events\n\nDesign considerations:\n- Large, high-contrast fonts readable from 10+ feet\n- Minimal UI chrome\n- Smooth transitions between views\n- Stays awake (prevent screen sleep with keepAwake API)\n- No interaction required (but touch-enabled for optional navigation)\n- Works in kiosk mode on cheap Android device or Raspberry Pi\n\nConfiguration: Parents can choose which views to include and rotation speed.","acceptance_criteria":"- Display mode shows all configured views\n- Auto-rotates at configurable intervals\n- Fonts are large and readable from distance\n- Stays awake continuously\n- Real-time updates (chores completed, etc.)\n- Works on TV browsers and kiosk devices\n- Parents can customize view order and duration","status":"open","priority":3,"issue_type":"feature","created_at":"2025-11-27T10:44:20.581413-05:00","updated_at":"2025-11-27T20:11:42.275163-05:00","dependencies":[{"issue_id":"fp-27","depends_on_id":"fp-24","type":"blocks","created_at":"2025-11-27T10:44:20.582591-05:00","created_by":"daemon"}]}
{"id":"fp-28","title":"Configure PWA for mobile installation and offline support","description":"Set up Progressive Web App capabilities so family members can install the app on their devices like a native app.","design":"PWA requirements:\n- manifest.json with app icons, name, theme colors\n- Service worker for caching static assets\n- Offline fallback page\n- \"Add to Home Screen\" prompt\n- App icons for iOS and Android (various sizes)\n- Splash screens for mobile\n\nNext.js has built-in PWA support via next-pwa package.\n\nOffline strategy:\n- Cache static assets (JS, CSS, fonts)\n- Cache API responses with stale-while-revalidate\n- Show offline indicator when no connection\n- Queue mutations for when back online (optional for MVP)","acceptance_criteria":"- App can be installed on iOS and Android devices\n- App icon appears on home screen\n- Works offline for viewing cached data\n- Service worker caches appropriate assets\n- Manifest is properly configured\n- App feels like a native app when installed","status":"open","priority":2,"issue_type":"task","created_at":"2025-11-27T10:44:29.625033-05:00","updated_at":"2025-11-27T20:11:42.275913-05:00","dependencies":[{"issue_id":"fp-28","depends_on_id":"fp-14","type":"blocks","created_at":"2025-11-27T10:44:29.625811-05:00","created_by":"daemon"}]}
{"id":"fp-29","title":"Set up Vercel deployment with CI/CD","description":"Configure cloud hosting on Vercel with automatic deployments from Git, environment variables, and production settings.","design":"Vercel setup:\n- Connect GitHub repository\n- Configure environment variables (Supabase keys, etc.)\n- Set up preview deployments for branches\n- Production deployment on main branch\n- Custom domain (optional)\n- Configure build settings for Next.js\n\nEnvironment management:\n- .env.local for development\n- .env.example template in repo\n- Vercel environment variables for staging/production\n\nCI/CD:\n- Auto-deploy on push to main\n- Preview deployments for PRs\n- Run tests before deploy (when tests exist)","acceptance_criteria":"- App is deployed to Vercel\n- Production URL is accessible\n- Environment variables are configured\n- Auto-deployment works on push\n- Preview deployments work for branches\n- SSL/HTTPS is enabled","notes":"Work complete. Awaiting PR review.\n\nCompleted:\n- Updated .env.example with Supabase environment variables\n- Created comprehensive docs/DEPLOYMENT.md guide\n- Verified production build works successfully\n- Updated .claude/settings.json with common permissions\n- Added critical workflow documentation to AGENTS.md and CLAUDE.md to prevent direct commits to main\n\nReady for Vercel setup after PR approval:\n1. Connect GitHub repository at vercel.com\n2. Add environment variables (see DEPLOYMENT.md)\n3. Deploy and verify production URL","status":"closed","priority":1,"issue_type":"task","assignee":"claude","created_at":"2025-11-27T10:44:38.30238-05:00","updated_at":"2025-11-27T23:04:41.363184-05:00","closed_at":"2025-11-27T23:04:41.363184-05:00","dependencies":[{"issue_id":"fp-29","depends_on_id":"fp-5","type":"blocks","created_at":"2025-11-27T10:44:38.303623-05:00","created_by":"daemon"}]}
{"id":"fp-3","title":"Fix GitHub Action to work with beads database not tracked in git","description":"The GitHub Action still fails with \"no beads database found\" even after setting BEADS_DIR. The issue is that beads.db file is not tracked in git (only issues.jsonl is tracked), so the action needs to either initialize from issues.jsonl or use a different approach.","design":"Root cause: The .beads/beads.db file is not tracked in git (it's in .gitignore). Only .beads/issues.jsonl is tracked. When the GitHub Action checks out the repo, there's no database file, so bd can't operate.\n\nPossible solutions:\n1. Run `bd init` in the workflow before trying to close issues - this should create the database and import from issues.jsonl\n2. Use `bd import` to explicitly import the issues.jsonl into a new database\n3. Modify .beads/.gitignore to track the database file (not recommended - database is binary and large)\n\nRecommended approach: Add a step to run `bd init` before the \"Close beads issue\" step. The bd daemon will automatically import from issues.jsonl when it finds it.","acceptance_criteria":"- GitHub Action successfully finds/creates beads database\n- bd close command executes successfully\n- Issues.jsonl is properly updated after closing\n- Workflow completes successfully when PR is merged\n- No manual database setup needed","notes":"Waiting for PR #5 review. Work complete: Added step to run 'bd init' in GitHub Action workflow to create database from tracked issues.jsonl file. This solves the \"no beads database found\" error since the database file itself is not tracked in git.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-11-27T19:19:15.493385-05:00","updated_at":"2025-11-27T21:12:52.771635-05:00","closed_at":"2025-11-27T21:12:52.771635-05:00"}
{"id":"fp-30","title":"Set up testing infrastructure (unit and integration)","description":"Configure Jest, React Testing Library, and test utilities for testing services, components, and API endpoints.","design":"Testing setup:\n- Jest for test runner with TypeScript support\n- React Testing Library for component tests\n- MSW (Mock Service Worker) for API mocking\n- Test database setup (Supabase mocking utilities)\n\nInitial focus areas (auth):\n- Database function unit tests (validate_kid_pin)\n- API route integration tests (/api/auth/pin-login)\n- Auth context component tests\n- Login form component tests\n- E2E tests with Playwright (parent/kid login flows)\n\nFuture focus areas (after fp-8):\n- Service layer unit tests (business logic)\n- Repository layer unit tests (data access with mocked DB)\n- Additional API route authorization tests\n- Complex user flow component tests\n\nExample tests to create now:\n- validate_kid_pin database function test\n- PIN login API route integration test\n- Auth context provider test\n- Login form component test (parent/kid modes)\n- E2E: Parent login flow\n- E2E: Kid PIN login flow with session persistence\n\nTest command: npm test\nCI integration for running tests on PR.","acceptance_criteria":"- Jest is configured and running with TypeScript\n- React Testing Library is set up\n- MSW is configured for API mocking\n- Supabase test utilities exist\n- Example unit tests exist for auth\n- Example integration tests exist for auth API routes\n- Example component tests exist for auth UI\n- E2E tests exist for auth flows (Playwright)\n- Test coverage reporting works\n- npm test command runs all tests\n- Tests can run in CI/CD pipeline\n- Documentation on writing new tests (with auth examples)\n- [Future] Add service layer test examples after fp-8\n- [Future] Add repository layer test examples after fp-8","notes":"Testing infrastructure is being implemented as part of fp-7 (auth fixes). Auth provides excellent test examples and is too critical to ship untested.\n\nOnce fp-7 is complete, fp-30 will be complete with:\n- Jest, React Testing Library, MSW configured\n- Auth unit, integration, component, and E2E tests\n- Test utilities and documentation\n- CI integration\n\nService/repository layer test examples will be added later when fp-8 is complete (as a separate piece of work, not blocking fp-30 closure).","status":"open","priority":2,"issue_type":"task","created_at":"2025-11-27T10:44:47.427326-05:00","updated_at":"2025-11-28T19:55:46.108699-05:00","dependencies":[{"issue_id":"fp-30","depends_on_id":"fp-7","type":"blocks","created_at":"2025-11-28T19:55:34.467399-05:00","created_by":"daemon"}]}
{"id":"fp-4","title":"Document architecture decisions and tech stack in docs/ARCHITECTURE.md","description":"Create comprehensive architecture documentation covering tech stack decisions, service layer pattern, modularity strategy, and design principles that enable future refactoring (including potential Go migration).","design":"Document should cover:\n- Tech stack: Next.js 14+, TypeScript, Supabase, Tailwind CSS\n- Architecture layers: Frontend â†’ API Client â†’ API Route â†’ Service â†’ Repository â†’ Database\n- Service layer pattern and why it enables modularity\n- Repository pattern for database abstraction\n- Feature-based code organization\n- Real-time updates via Supabase subscriptions\n- Authentication and authorization strategy\n- Calendar integration architecture (native, subscribed, work sync agent)\n- PWA setup for multi-device access\n- Future refactoring paths (Go microservices, etc.)\n- Design principles: modularity, testability, separation of concerns","acceptance_criteria":"- docs/ARCHITECTURE.md file exists\n- Covers all major architectural decisions from our planning\n- Explains the service layer and repository patterns\n- Documents why modularity was prioritized\n- Includes diagrams or clear explanations of data flow\n- Explains how to extract services to Go later\n- Clear enough for new developers to understand the system","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-27T11:06:50.158801-05:00","updated_at":"2025-11-27T21:13:01.447751-05:00","closed_at":"2025-11-27T21:13:01.447751-05:00"}
{"id":"fp-5","title":"Initialize Next.js project with TypeScript and core dependencies","description":"Set up Next.js 14+ with App Router, TypeScript, ESLint, and Prettier. Install core dependencies: Tailwind CSS, shadcn/ui, date-fns.","design":"Create Next.js app with: \n- TypeScript strict mode\n- App Router structure\n- Tailwind CSS configured\n- shadcn/ui components initialized\n- Basic folder structure: /app, /components, /lib, /services, /types\n- Environment variables template","acceptance_criteria":"- Next.js dev server runs successfully\n- TypeScript compilation works\n- Tailwind CSS is functional\n- shadcn/ui can be imported\n- Basic folder structure exists","notes":"Work complete and pushed to branch feature/fp-5-nextjs-setup. Waiting for PR review. All quality checks passed (lint + type-check). Next.js 16 with TypeScript, Tailwind CSS, and shadcn/ui fully configured.","status":"closed","priority":1,"issue_type":"task","assignee":"claude","created_at":"2025-11-27T10:40:57.504217-05:00","updated_at":"2025-11-27T21:57:32.835853-05:00","closed_at":"2025-11-27T21:57:32.835853-05:00"}
{"id":"fp-6","title":"Set up Supabase project and database schema","description":"Create Supabase project, configure PostgreSQL database, and define initial schema for users, roles, and core tables.","design":"Schema tables:\n- users (id, email, name, role: parent/kid, screen_time_daily_minutes)\n- chores (id, name, description, monetary_value_cents)\n- chore_assignments (id, chore_id, user_id, assigned_date, completed, completed_at)\n- incentive_types (id, name, unit, reward_cents_per_unit, reward_minutes_per_unit)\n- incentive_logs (id, user_id, incentive_type_id, date, units_completed, reward_type)\n- screen_time_sessions (id, user_id, date, start_time, end_time, duration_seconds)\n\nEnable Row Level Security policies for role-based access.","acceptance_criteria":"- Supabase project created\n- All tables exist with proper columns and types\n- RLS policies configured (kids can't access admin functions)\n- Connection string available for Next.js","notes":"Work complete. Database schema, RLS policies, and Supabase client utilities created. Migrations ready to apply. Documentation updated with migration workflow. Awaiting PR review.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-27T10:41:07.293269-05:00","updated_at":"2025-11-27T23:56:03.0667-05:00","closed_at":"2025-11-28T04:46:46.713808034Z","dependencies":[{"issue_id":"fp-6","depends_on_id":"fp-5","type":"blocks","created_at":"2025-11-27T10:41:07.294338-05:00","created_by":"daemon"}]}
{"id":"fp-622","title":"Add rate limiting and security controls to kid PIN validation","description":"The validate_kid_pin() function currently lacks rate limiting protection, allowing any authenticated user to potentially brute-force a 4-digit PIN (10,000 combinations) for any kid's account.\n\nSecurity issues to address:\n1. No database-level rate limiting - function can be called unlimited times\n2. Too permissive grants - any authenticated user can call the function for any kid\n3. No exponential backoff after failed attempts\n\nLocation: supabase/migrations/003_add_kid_pin.sql:14-40","design":"Approach:\n1. Create new migration file (004_add_pin_rate_limiting.sql)\n2. Add table to track PIN validation attempts (kid_id, attempt_time, success, ip_address)\n3. Modify validate_kid_pin() to:\n   - Check rate limits before validation\n   - Record all validation attempts\n   - Implement exponential backoff (e.g., 1s, 2s, 4s, 8s delays)\n   - Return appropriate error messages\n4. Update RLS policies to restrict function access\n5. Consider adding audit logging for security monitoring","acceptance_criteria":"- Database-level rate limiting implemented (track failed attempts per kid/IP)\n- Function restricted to only parents or the kid themselves (not all authenticated users)\n- Exponential backoff added after failed attempts\n- Migration file created in supabase/migrations/\n- Security controls tested and verified","status":"open","priority":1,"issue_type":"bug","created_at":"2025-11-28T19:57:45.969909-05:00","updated_at":"2025-11-28T19:57:45.969909-05:00","dependencies":[{"issue_id":"fp-622","depends_on_id":"fp-7","type":"blocks","created_at":"2025-11-28T19:57:45.972484-05:00","created_by":"daemon"}]}
{"id":"fp-7","title":"Implement authentication with parent and kid roles","description":"Set up Supabase Auth in Next.js with role-based access control. Parents use email/password, kids can use simplified PIN-based login.","design":"- Configure Supabase Auth client\n- Create auth context/provider\n- Login page with role detection\n- Protected routes via middleware\n- Session management\n- Kid login can be simplified (4-digit PIN stored as metadata)","acceptance_criteria":"- Parents can login with email/password\n- Kids can login with simplified method\n- User role is accessible throughout app\n- Protected routes redirect unauthenticated users\n- Session persists across page refreshes","notes":"Code review identified critical issue: PIN login validates but doesn't create authenticated session. Implementing fixes with magic link tokens + comprehensive testing infrastructure.","status":"in_progress","priority":1,"issue_type":"feature","created_at":"2025-11-27T10:41:14.441672-05:00","updated_at":"2025-11-28T19:49:23.985218-05:00","dependencies":[{"issue_id":"fp-7","depends_on_id":"fp-6","type":"blocks","created_at":"2025-11-27T10:41:14.442315-05:00","created_by":"daemon"}]}
{"id":"fp-7a","title":"Create family relationships database schema","description":"Create migration 004_add_family_relationships.sql with flexible family schema supporting multiple parents, blended families, and guardians. Includes families table, family_members junction table, RLS policies, and helper functions.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-28T19:49:24.043062-05:00","updated_at":"2025-11-28T19:52:29.330901-05:00","closed_at":"2025-11-28T19:52:29.330901-05:00","dependencies":[{"issue_id":"fp-7a","depends_on_id":"fp-7","type":"blocks","created_at":"2025-11-28T19:49:24.044465-05:00","created_by":"daemon"}]}
{"id":"fp-7b","title":"Fix PIN login to create authenticated sessions via magic link tokens","description":"Update app/api/auth/pin-login/route.ts to use admin client to generate magic link tokens. Update lib/auth/context.tsx signInWithPin to consume tokens via verifyOtp. This creates proper Supabase Auth sessions for kids.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-28T19:49:24.101243-05:00","updated_at":"2025-11-28T19:54:43.496687-05:00","closed_at":"2025-11-28T19:54:43.496687-05:00","dependencies":[{"issue_id":"fp-7b","depends_on_id":"fp-7a","type":"blocks","created_at":"2025-11-28T19:49:24.102769-05:00","created_by":"daemon"}]}
{"id":"fp-7c","title":"Set up Jest and React Testing Library infrastructure","description":"Install and configure Jest, React Testing Library, MSW, and test utilities. Create jest.config.ts, jest.setup.ts, and Supabase mocking utilities. Add test scripts to package.json.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-28T19:49:24.160426-05:00","updated_at":"2025-11-28T20:04:47.474783-05:00","closed_at":"2025-11-28T20:04:47.474783-05:00","dependencies":[{"issue_id":"fp-7c","depends_on_id":"fp-7","type":"blocks","created_at":"2025-11-28T19:49:24.161884-05:00","created_by":"daemon"}]}
{"id":"fp-7d","title":"Write unit and integration tests for auth","description":"Create comprehensive test suite: PIN login API route tests, auth context component tests, login page component tests. Verify PIN validation, session creation, error handling, and authorization.","status":"in_progress","priority":1,"issue_type":"task","created_at":"2025-11-28T19:49:24.222044-05:00","updated_at":"2025-11-28T20:04:57.59493-05:00","dependencies":[{"issue_id":"fp-7d","depends_on_id":"fp-7b","type":"blocks","created_at":"2025-11-28T19:49:24.223399-05:00","created_by":"daemon"},{"issue_id":"fp-7d","depends_on_id":"fp-7c","type":"blocks","created_at":"2025-11-28T19:49:24.225693-05:00","created_by":"daemon"}]}
{"id":"fp-7e","title":"Create E2E tests for authentication flows","description":"Write Playwright E2E tests for parent login, kid PIN login, session persistence, sign out, and protected route redirects. Verify complete user flows work end-to-end.","status":"open","priority":1,"issue_type":"task","created_at":"2025-11-28T19:49:24.467769-05:00","updated_at":"2025-11-28T19:49:24.467769-05:00","dependencies":[{"issue_id":"fp-7e","depends_on_id":"fp-7d","type":"blocks","created_at":"2025-11-28T19:49:24.469374-05:00","created_by":"daemon"}]}
{"id":"fp-7f","title":"Update documentation for auth and testing","description":"Update docs/AUTH.md with magic link approach, family relationships, setup instructions. Create docs/TESTING.md with comprehensive testing guide, examples, and CI integration instructions.","status":"open","priority":1,"issue_type":"task","created_at":"2025-11-28T19:49:24.812946-05:00","updated_at":"2025-11-28T19:49:24.812946-05:00","dependencies":[{"issue_id":"fp-7f","depends_on_id":"fp-7e","type":"blocks","created_at":"2025-11-28T19:49:24.81443-05:00","created_by":"daemon"}]}
{"id":"fp-7g","title":"Add GitHub Actions CI workflow for tests","description":"Create or update .github/workflows/test.yml to run type-check, lint, unit tests, and E2E tests on every PR. Include coverage reporting and test result artifacts.","status":"open","priority":1,"issue_type":"task","created_at":"2025-11-28T19:49:25.127629-05:00","updated_at":"2025-11-28T19:49:25.127629-05:00","dependencies":[{"issue_id":"fp-7g","depends_on_id":"fp-7f","type":"blocks","created_at":"2025-11-28T19:49:25.129579-05:00","created_by":"daemon"}]}
{"id":"fp-8","title":"Create service and repository layer architecture","description":"Establish clean architecture with service layer (business logic) and repository layer (data access) to enable future refactoring and modularity.","design":"Structure:\n- /lib/services/ - Business logic services (ChoreService, UserService, etc.)\n- /lib/repositories/ - Data access layer (abstracts Supabase calls)\n- /lib/api/ - API client wrapper for frontend\n- /types/ - Shared TypeScript types and domain models\n\nPattern: API Route â†’ Service â†’ Repository â†’ Database\n\nThis enables extracting services to Go microservices later without touching routes or frontend.","acceptance_criteria":"- Folder structure exists\n- Example service class with business logic\n- Example repository class with data access\n- API client wrapper for frontend\n- Documentation on how to use each layer","status":"open","priority":1,"issue_type":"task","created_at":"2025-11-27T10:41:23.272281-05:00","updated_at":"2025-11-27T20:11:42.265087-05:00","dependencies":[{"issue_id":"fp-8","depends_on_id":"fp-7","type":"blocks","created_at":"2025-11-27T10:41:23.273556-05:00","created_by":"daemon"}]}
{"id":"fp-8qh","title":"Replace kid UUID input with visual name/avatar selector","description":"Kids currently must manually enter their UUID to login, which is a poor UX. The login form says \"Select your name\" but provides a text input, and instructs kids to \"Ask your parent for your user ID\" - exposing technical implementation details to young users.\n\nLocation: app/login/page.tsx:145-159\n\nThe text input should be replaced with a visual selector that fetches and displays kid names (and optionally avatars) from the database, allowing kids to simply click/tap their name to login.","design":"**Current Implementation (Bad UX):**\n```tsx\n\u003cInput\n  id=\"userId\"\n  type=\"text\"\n  placeholder=\"Select your name\"\n  value={userId}\n  onChange={(e) =\u003e setUserId(e.target.value)}\n  required\n/\u003e\n\u003cp className=\"text-xs text-muted-foreground\"\u003e\n  Ask your parent for your user ID\n\u003c/p\u003e\n```\n\n**Proposed Solution:**\n\n1. **API Endpoint** - GET /api/kids\n   - Fetches all kid users (role='kid') from users table\n   - Returns: id, name, avatar_url (if we add avatar support)\n   - Public endpoint (no auth required for login flow)\n   - Filtered to only return kids with PINs set\n\n2. **Visual Selector Component**\n   - Grid/list of kid cards/buttons\n   - Each card shows:\n     - Kid's name (large, readable font)\n     - Optional: Avatar image or initial letter in colored circle\n   - onClick handler sets userId state\n   - Visual feedback for selected kid\n   - Mobile-friendly tap targets (min 44x44px)\n\n3. **UI Flow**\n   - Kid sees grid of names when \"I'm a kid\" is selected\n   - Clicks their name â†’ userId is set\n   - Enters 4-digit PIN\n   - Submits form\n\n**Component Structure:**\n```tsx\n// New component: components/auth/KidSelector.tsx\ninterface KidSelectorProps {\n  onSelect: (userId: string) =\u003e void;\n  selectedUserId?: string;\n}\n\n// Usage in app/login/page.tsx\n{role === 'kid' \u0026\u0026 (\n  \u003cKidSelector\n    onSelect={setUserId}\n    selectedUserId={userId}\n  /\u003e\n)}\n```\n\n**Future Enhancement (Optional):**\n- Add avatar_url column to users table\n- Allow parents to upload kid photos or choose avatar icons\n- Display avatars in the selector","acceptance_criteria":"- Kid selector component created in components/auth/KidSelector.tsx\n- API endpoint /api/kids returns all kids with name and id\n- Endpoint only returns kids who have PINs set (can actually login)\n- Login page displays visual kid selector instead of text input\n- Kids can click/tap their name to select themselves\n- Selected kid is visually indicated (highlighted/checked)\n- No UUIDs or technical terms shown to kids\n- Component is mobile-friendly with proper touch targets\n- Works on small screens (mobile) and large screens (tablet/desktop)\n- Maintains existing PIN input functionality after kid selection\n- Error handling if no kids exist in database (edge case)","status":"open","priority":2,"issue_type":"feature","created_at":"2025-11-28T20:00:46.686795-05:00","updated_at":"2025-11-28T20:03:54.072134-05:00","dependencies":[{"issue_id":"fp-8qh","depends_on_id":"fp-7","type":"blocks","created_at":"2025-11-28T20:00:46.689144-05:00","created_by":"daemon"}]}
{"id":"fp-9","title":"Document parallel agent workflow with separate clones","description":"Create comprehensive documentation for running multiple AI agents in parallel using separate repository clones instead of git worktrees. Includes setup guide, helper scripts, workflow instructions, and updates to AGENTS.md and CLAUDE.md.","notes":"Waiting for PR #2 review. Work complete: Updated AGENTS.md to use gh CLI for PR creation, added rebase step before commits, implemented automatic issue closure via GitHub Actions when PR merges with bracketed issue ID in title.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-27T12:56:57.503549-05:00","updated_at":"2025-11-27T23:03:18.441635-05:00","closed_at":"2025-11-27T23:03:18.441635-05:00"}
{"id":"fp-93y","title":"Build parent UI for managing kid accounts and PINs","description":"Create a parent-only admin interface for creating kid accounts, setting/resetting their PINs, and managing kid profiles. This completes the kid authentication workflow by allowing parents to provision kid accounts without manual database/SQL intervention.","design":"Parent admin UI at /admin/kids with functionality for:\n\n**Kid Account Creation:**\n- Form to create new kid account\n  - Name (required)\n  - Email (optional - if not provided, generate dummy email: kid-{uuid}@family-panel.internal)\n  - Initial PIN (4 digits, required)\n  - Daily screen time limit (minutes, default: 120)\n- Backend API creates both:\n  1. Supabase Auth user (via admin.generateLink or admin.createUser)\n  2. Users table record with role='kid'\n  3. Family_members relationship to parent's family\n  4. PIN hash via set_kid_pin() function\n\n**Kid Management:**\n- List all kids in parent's family\n- For each kid, show:\n  - Name, email (or \"No email\" for dummy emails)\n  - Daily screen time limit\n  - Current PIN status (set/not set)\n  - Account created date\n- Actions per kid:\n  - Edit profile (name, screen time limit)\n  - Reset PIN (with confirmation)\n  - Deactivate/reactivate account\n  - Delete account (with strong confirmation)\n\n**PIN Management:**\n- \"Reset PIN\" button for each kid\n- Modal with:\n  - Current kid's name\n  - New PIN input (4 digits)\n  - Confirm new PIN input\n  - Submit to update via set_kid_pin()\n- Success/error messaging\n\n**API Endpoints:**\n- POST /api/admin/kids - Create kid account\n- GET /api/admin/kids - List kids in parent's family\n- PATCH /api/admin/kids/[id] - Update kid profile\n- POST /api/admin/kids/[id]/reset-pin - Reset kid PIN\n- DELETE /api/admin/kids/[id] - Delete kid account\n\n**Authorization:**\n- All endpoints check that authenticated user has role='parent'\n- Parents can only manage kids in their own family\n- Use RLS policies + server-side role checks\n\n**Technical Details:**\n- Use admin Supabase client for creating Auth accounts\n- Generate secure dummy emails for kids without real emails\n- Ensure atomic operations (Auth + DB + family relationship)\n- Handle rollback if any step fails\n- Validate PIN format (exactly 4 digits) client and server side\n\n**UI/UX:**\n- Kid creation form accessible from /admin/kids\n- Table/card view of existing kids\n- Inline actions for common operations (reset PIN)\n- Confirmation dialogs for destructive actions\n- Clear success/error feedback\n- Mobile-responsive design","acceptance_criteria":"- Parents can create new kid accounts via UI\n- System creates Supabase Auth account automatically\n- System generates dummy email if real email not provided\n- Parents can set initial PIN during kid creation\n- Parents can view all kids in their family\n- Parents can edit kid profiles (name, screen time limit)\n- Parents can reset kid PINs via UI\n- Parents can delete kid accounts (with confirmation)\n- All operations are properly authorized (parents only)\n- Parents can only manage kids in their own family\n- Error handling is robust (rollback on failures)\n- UI is intuitive and mobile-friendly\n- Success/error messages are clear","status":"open","priority":1,"issue_type":"feature","created_at":"2025-11-28T19:45:29.689289-05:00","updated_at":"2025-11-28T19:45:29.689289-05:00","dependencies":[{"issue_id":"fp-93y","depends_on_id":"fp-7","type":"blocks","created_at":"2025-11-28T19:45:29.69181-05:00","created_by":"daemon"}]}
{"id":"fp-bl0","title":"Replace UUID input with visual kid selector on login page","description":"Kids currently must manually enter their UUID on the login page (app/login/page.tsx:145-159), which is poor UX. The placeholder says \"Select your name\" but it's just a text input, and kids are told to \"Ask your parent for your user ID\".\n\nReplace the text input with a visual selector that:\n- Fetches and displays kid names/avatars from the database\n- Allows kids to click/tap their profile to select themselves\n- Eliminates the need for kids to handle UUIDs","acceptance_criteria":"- Visual selector component displays all kids in the family\n- Each kid shown with name and avatar (if available)\n- Clicking a kid profile sets the userId\n- No UUID input required from kid users\n- Component fetches kid data from database","status":"open","priority":2,"issue_type":"feature","created_at":"2025-11-28T20:04:39.093111-05:00","updated_at":"2025-11-28T20:04:39.093111-05:00","dependencies":[{"issue_id":"fp-bl0","depends_on_id":"fp-7","type":"blocks","created_at":"2025-11-28T20:04:48.587592-05:00","created_by":"daemon"}]}
{"id":"fp-hts","title":"Define proper types for Supabase RPC functions to eliminate type assertions","description":"Currently using `as any` type assertion for RPC calls in app/api/auth/pin-login/route.ts:31-34.\n\nLocation:\n```typescript\nconst { data: isValid, error } = await supabase.rpc('validate_kid_pin', {\n  p_user_id: userId,\n  p_pin: pin,\n} as any); // Type assertion needed due to RPC type limitations\n```\n\nRecommendation:\nDefine proper types in lib/supabase/types.ts for database functions:\n\n```typescript\ntype Database = {\n  Functions: {\n    validate_kid_pin: {\n      Args: { p_user_id: string; p_pin: string }\n      Returns: boolean\n    }\n  }\n}\n```\n\nThis will eliminate the need for type assertions and provide proper type safety for RPC calls.","status":"open","priority":3,"issue_type":"task","created_at":"2025-11-28T20:08:24.817094-05:00","updated_at":"2025-11-28T20:08:24.817094-05:00","dependencies":[{"issue_id":"fp-hts","depends_on_id":"fp-7","type":"blocks","created_at":"2025-11-28T20:08:32.513024-05:00","created_by":"daemon"}]}
{"id":"fp-ogl","title":"Fix regex pattern for extracting beads issue ID from PR title","description":"Update the regex pattern in the GitHub Action workflow to correctly extract beads issue IDs from PR titles. The current pattern doesn't match the new prefix format properly.","design":"The GitHub Action workflow uses a regex to extract the beads issue ID from PR titles in the format [issue-id].\n\nThe regex pattern needs to be updated to properly match issue IDs with the correct prefix format. This ensures the workflow can automatically close issues when PRs are merged.","acceptance_criteria":"- Regex correctly extracts beads issue IDs from PR titles\n- Works with current issue ID format\n- GitHub Action can find and close issues successfully\n- No false positives or missed matches","notes":"Waiting for PR #9 review. Work complete: Updated regex pattern in GitHub Action workflow to correctly match current beads issue ID format (e.g., fp-ogl, fp-y4t). This fixes the issue where the workflow couldn't extract and close issues from PR titles.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-11-27T20:45:49.765252-05:00","updated_at":"2025-11-27T21:13:07.241313-05:00","closed_at":"2025-11-27T21:13:07.241313-05:00"}
{"id":"fp-tz8","title":"Set up Playwright for E2E testing and development observation","description":"Configure Playwright for end-to-end browser testing and to enable Claude Code to observe and interact with the running application during development.","design":"Playwright setup:\n- Install @playwright/test and browsers (Chromium, Firefox, WebKit)\n- Configure playwright.config.ts with baseURL for localhost:3000\n- Set up test directory structure (/tests/e2e or /e2e)\n- Configure test scripts in package.json\n\nDevelopment observation features:\n- Headed mode configuration for Claude Code to see browser\n- Screenshot/video capture capabilities\n- Network request inspection\n- Console log capture\n\nE2E testing capabilities:\n- Critical user flows (login, chore assignment, screen time tracking)\n- Cross-browser testing\n- Visual regression testing (optional)\n- CI integration with GitHub Actions\n\nExample tests to create:\n- Authentication flow test\n- Parent assigns chore to kid flow\n- Kid completes chore and earns screen time flow\n- Screen time countdown and lockout flow\n\nCommands:\n- npm run test:e2e - Run E2E tests headless\n- npm run test:e2e:ui - Run with Playwright UI mode\n- npm run test:e2e:headed - Run headed for Claude Code observation\n- npm run test:e2e:debug - Debug mode with inspector","acceptance_criteria":"- Playwright is installed and configured\n- playwright.config.ts exists with proper settings\n- Test directory structure is set up\n- At least 2 example E2E tests exist\n- Tests can run headless in CI\n- Tests can run headed for development/observation\n- Screenshot capability works\n- Documentation on writing new E2E tests\n- Claude Code can observe running app via headed tests","notes":"Work complete. Awaiting PR review. Added Playwright MCP documentation to CLAUDE.md and PARALLEL_AGENTS.md, including port management strategy for parallel agents. Updated launch-agent.sh script to copy and configure .env.local with unique ports per agent slot.","status":"closed","priority":2,"issue_type":"task","assignee":"claude","created_at":"2025-11-27T22:05:30.133571-05:00","updated_at":"2025-11-28T14:55:18.031445-05:00","closed_at":"2025-11-28T19:42:53.645690073Z"}
{"id":"fp-y4t","title":"Fix database inconsistencies with issue ID prefixes","description":"The beads database has inconsistent issue ID prefixes - some issues use 'family-panel-' prefix while others use different prefixes. Need to standardize all issues to use the correct 'family-panel-' prefix.","design":"The GitHub Action revealed that the database has issues with inconsistent prefixes:\n- Expected prefix: 'family-panel-'\n- Found issues with prefix: 'family-' (3 issues)\n\nThis causes import failures during sync operations.\n\nSolution: Manually review and fix the issues.jsonl file to ensure all issues use the 'family-panel-' prefix consistently. This may involve:\n1. Checking issues.jsonl for any inconsistent prefixes\n2. Using bd commands or manual editing to fix prefix issues\n3. Ensuring the database and JSONL are in sync with consistent prefixes\n4. Committing the corrected issues.jsonl","acceptance_criteria":"- All issues in issues.jsonl use 'family-panel-' prefix consistently\n- No prefix mismatch errors when importing\n- Database and JSONL are in sync\n- GitHub Action can successfully sync without prefix errors","notes":"Waiting for PR #8 review. Work complete: Updated beads database tracking files (issues.jsonl and deletions.jsonl) to ensure all issues use consistent 'family-panel-' prefix. This resolves prefix mismatch errors that were preventing the GitHub Action from successfully syncing and committing issue closures.","status":"closed","priority":0,"issue_type":"chore","created_at":"2025-11-27T20:17:57.193162-05:00","updated_at":"2025-11-27T21:13:08.367867-05:00","closed_at":"2025-11-27T21:13:08.367867-05:00"}
{"id":"fp-ycj","title":"Fix GitHub Action permissions to allow pushing updated issues.jsonl","description":"The GitHub Action fails when trying to push the updated issues.jsonl back to the repository with 'Permission denied' error for github-actions[bot].","design":"Error from workflow:\n```\nError pushing: git push failed: exit status 128\nremote: Permission to brennon/family-panel.git denied to github-actions[bot].\nfatal: unable to access 'https://github.com/brennon/family-panel/': The requested URL returned error: 403\n```\n\nRoot cause: The GitHub Action workflow doesn't have write permissions to push changes back to the repository. The default GITHUB_TOKEN needs explicit permissions.\n\nSolution: Add permissions block to the workflow job to grant contents write permission:\n\n```yaml\njobs:\n  close-issue:\n    runs-on: ubuntu-latest\n    permissions:\n      contents: write\n      pull-requests: read\n```\n\nThis grants the workflow permission to:\n- Read pull requests (to extract PR title)\n- Write contents (to push updated issues.jsonl back to main)","acceptance_criteria":"- GitHub Action has write permissions\n- Can successfully push updated issues.jsonl to main\n- No permission denied errors\n- Workflow completes successfully when PR is merged","notes":"Waiting for PR review. Work complete: Added permissions block to GitHub Action workflow to grant contents:write permission, allowing github-actions[bot] to push updated issues.jsonl back to main branch after closing beads issues.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-11-27T20:53:04.341393-05:00","updated_at":"2025-11-27T20:58:44.956053-05:00","closed_at":"2025-11-28T01:57:24.523002076Z"}
